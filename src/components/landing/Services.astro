---
import { Image } from "astro:assets";
import advertisingSvg from "@assets/images/services/advertising.svg?raw";
import designSvg from "@assets/images/services/creative-designer-doing-multitasking.svg?raw";
import mobileSvg from "@assets/images/services/mobile-app-ui-ux-design.svg?raw";
import seoSvg from "@assets/images/services/seo-link-building.svg?raw";
import websiteSvg from "@assets/images/services/website-ui-ux-development.svg?raw";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

// Import portfolio logos
import hustleGearLogo from "@assets/images/portfolio/ Hustle_logo png.png";
import buddsLogo from "@assets/images/portfolio/BuddsLogo.png";
import blueLawnsLogo from "@assets/images/portfolio/BlueLawnsLogo.png";
import cabinetCompanyLogo from "@assets/images/portfolio/TheCabinetCompany.png";
import s2sLogo from "@assets/images/portfolio/S2Slogo.png";
import shoreHandymanLogo from "@assets/images/portfolio/Shorehandymanlogo.png";
import bestLifeLogo from "@assets/images/portfolio/BestLife-01.png";
import ecoastPoolLogo from "@assets/images/portfolio/ecoastpoolservicelogo.png";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const { class: className } = Astro.props;

// Virgo's portfolio companies with SEO-optimized copy
const points = [
	{
		title: "Hustle Gear",
		content: "Premium custom athletic wear and team uniforms for champions<br><span style='color: #f59e0b; font-weight: 600'>285% increase in online orders, 12 new regional markets</span>",
		logo: hustleGearLogo,
		website: "https://www.hustle-gear.com",
	},
	{
		title: "Budd's Plumbing & HVAC",
		content: "Trusted residential and commercial plumbing experts serving your community<br><span style='color: #f59e0b; font-weight: 600'>340% more qualified leads through local SEO optimization</span>",
		logo: buddsLogo,
		website: "https://buddsplumbing.com",
	},
	{
		title: "Blue Lawns",
		content: "Professional landscaping and lawn care services that transform outdoor spaces<br><span style='color: #f59e0b; font-weight: 600'>225% growth in seasonal contracts through strategic marketing</span>",
		logo: blueLawnsLogo,
		website: "https://www.bluelawns.com",
	},
	{
		title: "The Cabinet Company",
		content: "Custom kitchen and bathroom cabinetry crafted for modern living<br><span style='color: #f59e0b; font-weight: 600'>190% increase in consultations, 45% higher project values</span>",
		logo: cabinetCompanyLogo,
		website: "https://www.thecabinetco.co",
	},
	{
		title: "S2S Media",
		content: "Your marketing company powered by AI - driving results through intelligent automation<br><span style='color: #f59e0b; font-weight: 600'>400% ROI improvement through AI-driven strategies</span>",
		logo: s2sLogo,
		website: "https://www.s2smedia.net",
	},
	{
		title: "Shore Handyman",
		content: "Professional home services for the small jobs no one else wants<br><span style='color: #f59e0b; font-weight: 600'>265% increase in recurring customers through digital experience</span>",
		logo: shoreHandymanLogo,
		website: "https://www.yourshorehandyman.com",
	},
	{
		title: "Best Life Counseling Services",
		content: "Comprehensive mental health support through in-home, outpatient, and telehealth counseling<br><span style='color: #f59e0b; font-weight: 600'>180% increase in client bookings through digital transformation</span>",
		logo: bestLifeLogo,
		website: "https://www.bestlifenj.com",
	},
	{
		title: "Ecoast Pool Service",
		content: "Professional pool cleaning, maintenance, and repair services for residential and commercial properties<br><span style='color: #f59e0b; font-weight: 600'>310% increase in recurring service contracts through local SEO</span>",
		logo: ecoastPoolLogo,
		website: "https://www.ecoastpoolservice.com",
	},
];
---

<section id="services" class:list={["section home-dark-section services-section relative", className]}>
	<div class="wrapper col-span-12 h-screen w-full">
		<h2 class="font-display text-4xl uppercase mb-12 text-center md:text-5xl lg:text-6xl">Our Portfolio</h2>
		<div class="indicators absolute left-0 top-0 mt-[10vh] hidden h-[80vh] w-1 flex-col justify-between gap-2">
			{points.map(() => <div class="indicator w-full grow bg-[#333333]" />)}
		</div>
		{
			points.map(({ title, content, logo, website }) => (
				<div class="point flex h-screen w-full flex-col items-center justify-center gap-x-20 gap-y-8 p-8 md:p-16 pr-0 md:flex-row lg:gap-x-40">
					<!-- Desktop Logo (hidden on mobile) -->
					<a href={website} target="_blank" rel="noopener noreferrer" class="hidden w-full max-w-80 lg:block hover:scale-105 transition-transform duration-300">
						<div class="w-48 h-48 bg-white rounded-2xl flex items-center justify-center shadow-2xl">
							<Image
								src={logo}
								alt={title}
								width={120}
								height={80}
								format="webp"
								quality={75}
								loading="lazy"
								class="max-w-[120px] max-h-20 object-contain"
							/>
						</div>
					</a>

					<article class="flex flex-col gap-8 md:gap-14 items-center md:items-start">
						<!-- Mobile Logo (centered above title) -->
						<a href={website} target="_blank" rel="noopener noreferrer" class="block lg:hidden hover:scale-105 transition-transform duration-300">
							<div class="w-32 h-32 bg-white rounded-xl flex items-center justify-center shadow-xl">
								<Image
									src={logo}
									alt={title}
									width={80}
									height={60}
									format="webp"
									quality={75}
									loading="lazy"
									class="max-w-[80px] max-h-[60px] object-contain"
								/>
							</div>
						</a>

						<div class="text-center md:text-left">
							<a href={website} target="_blank" rel="noopener noreferrer" class="hover:text-amber-500 transition-colors duration-300">
								<h3 class="faq font-display text-3xl uppercase md:text-4xl lg:text-5xl xl:text-6xl">{title}</h3>
							</a>
						</div>

						<a href={website} target="_blank" rel="noopener noreferrer" class="hover:text-gray-300 transition-colors duration-300 text-center md:text-left">
							<p class="max-w-2xl text-base md:text-lg" set:html={content} />
						</a>
					</article>
				</div>
			))
		}
	</div>
</section>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";

	gsap.registerPlugin(ScrollTrigger);

	function init() {
		var points = gsap.utils.toArray(".point") as gsap.DOMTarget[];
		var indicators = gsap.utils.toArray(".indicator") as gsap.DOMTarget[];

		var height = 100 * points.length;

		// Refresh ScrollTrigger for mobile
		ScrollTrigger.refresh();

		gsap.set(".indicators", { display: "flex" });

		var tl = gsap.timeline({
			duration: points.length,
			scrollTrigger: {
				trigger: "#services",
				start: "top center",
				end: "+=" + height + "%",
				scrub: 0.5,
				markers: false,
				id: "points",
				immediateRender: false,
			},
		});

		var pinner = gsap.timeline({
			scrollTrigger: {
				trigger: ".services-section .wrapper",
				start: "top top",
				end: "+=" + height + "%",
				scrub: 0.5,
				pin: ".services-section .wrapper",
				pinSpacing: true,
				id: "pinning",
				markers: false,
				snap: {
					snapTo: [0, 0.25, 0.5, 0.7, 0.9], // snap to the closest label in the timeline
					duration: { min: 0.1, max: 0.1 }, // the snap animation should be at least 0.2 seconds, but no more than 3 seconds (determined by velocity)
					delay: 1, // wait 1 seconds from the last scroll event before doing the snapping
					inertia: false,
					directional: false,
					ease: "power1.inOut", // the ease of the snap animation ("power3" by default)
				},
			},
		});

		points.forEach(function (elem, i) {
			gsap.set(elem, { position: "absolute", top: 0, zIndex: i === 0 ? 10 : 1 });

			// Animate indicators
			tl.to(indicators[i], { backgroundColor: "white", duration: 0.25 }, i);

			// Show current element
			tl.set(elem, { zIndex: 10, pointerEvents: "auto" }, i);

			// Animate logo (target the div inside the link, not the link itself)
			const logoElement = (elem as HTMLElement).querySelector("a div") || (elem as HTMLElement).querySelector(".hidden div");
			if (logoElement) {
				tl.from(logoElement, { autoAlpha: 0, scale: 0.8 }, i);
			}

			// Animate article content
			tl.from((elem as HTMLElement).querySelector("article"), { autoAlpha: 0, translateY: 100 }, i);

			if (i != points.length - 1) {
				tl.to(indicators[i], { backgroundColor: "#333333", duration: 0.25 }, i + 0.75);
				tl.to((elem as HTMLElement).querySelector("article"), { autoAlpha: 0, translateY: -100 }, i + 0.75);

				// Animate logo out (target the div inside the link)
				if (logoElement) {
					tl.to(logoElement, { autoAlpha: 0, scale: 0.8 }, i + 0.75);
				}

				// Hide current element
				tl.set(elem, { zIndex: 1, pointerEvents: "none" }, i + 1);
			}
		});

		// Handle mobile orientation changes and resize
		window.addEventListener("resize", () => {
			ScrollTrigger.refresh();
		});

		window.addEventListener("orientationchange", () => {
			setTimeout(() => {
				ScrollTrigger.refresh();
			}, 500);
		});
	}

	document.removeEventListener("DOMContentLoaded", init); // astro:page-load
	document.addEventListener("DOMContentLoaded", init); // astro:page-load
</script>
